#! /bin/bash

#Test for module BandsExtractor

if [ $# -lt 3 ]
then
  echo "Usage: $0 <otb apllication directory> <reference files directory> <out folder name>"
  echo "The output directory should be given" 1>&2  
  exit
fi

source functions.sh

CROPTYPE_OTB_LIBS_ROOT="$1"
REFERENCE_FOLDER="$2"
OUT_FOLDER="$3"

INPUT_DESCRIPTORS="$REFERENCE_FOLDER/SPOT4_HRVIR1_XS_20130402_N2A_EUkraineD0000B0000/SPOT4_HRVIR1_XS_20130402_N2A_EUkraineD0000B0000.xml "
INPUT_DESCRIPTORS+="$REFERENCE_FOLDER/SPOT4_HRVIR1_XS_20130412_N2A_EUkraineD0000B0000/SPOT4_HRVIR1_XS_20130412_N2A_EUkraineD0000B0000.xml "
INPUT_DESCRIPTORS+="$REFERENCE_FOLDER/SPOT4_HRVIR1_XS_20130417_N2A_EUkraineD0000B0000/SPOT4_HRVIR1_XS_20130417_N2A_EUkraineD0000B0000.xml "
INPUT_DESCRIPTORS+="$REFERENCE_FOLDER/SPOT4_HRVIR1_XS_20130422_N2A_EUkraineD0000B0000/SPOT4_HRVIR1_XS_20130422_N2A_EUkraineD0000B0000.xml "
INPUT_DESCRIPTORS+="$REFERENCE_FOLDER/SPOT4_HRVIR1_XS_20130427_N2A_EUkraineD0000B0000/SPOT4_HRVIR1_XS_20130427_N2A_EUkraineD0000B0000.xml "

TOCR="$OUT_FOLDER/tocr.tif"
MASK="$OUT_FOLDER/mask.tif"
DATES="$OUT_FOLDER/dates.txt"
SHAPE="$OUT_FOLDER/shape.shp"
RESOLUTION=20

try otbcli BandsExtractor $CROPTYPE_OTB_LIBS_ROOT/BandsExtractor/ -il $INPUT_DESCRIPTORS -out $TOCR -mask $MASK -outdate $DATES -shape $SHAPE -pixsize $RESOLUTION

validateRasterFile $TOCR "$REFERENCE_FOLDER/tocr.tif"
validateRasterFile $MASK "$REFERENCE_FOLDER/mask.tif"
validateTextFile $DATES "$REFERENCE_FOLDER/dates.txt"
validateShapeFile $SHAPE "$REFERENCE_FOLDER/shape.shp"
